# Build great solutions with the Microsoft Azure Well-Architected Framework
## Introduction to the Microsoft Azure Well-Architected Framework
- The Azure Well-Architected Framework will help you to design, build, and continuously improve a secure, reliable, and efficient application.
- The Azure Well-Architected Framework consists of five pillars:
    - Cost optimization
    - Operational excellence
    - Performance efficiency
    - Reliability
    - Security
- Automation is a key aspect of 'Operational Excellence' pillar to remove variance and error while increasing operational agility.
- General design principles:
    - Enable architectural evolution
    - Use data to make decisions
    - Educate and enable
    - Automate
- When an organization decides to own infrastructure, it buys equipment that goes onto the balance sheet as assets. Because a capital investment was made, accountants categorize this transaction as a **capital expense (CapEx)**. 
- Cloud services, on the other hand, are categorized as an **operating expense (OpEx)**, because of their consumption model.
- Optimize your systems at every level. At the network level, ensure that data transfer is efficient and meets the expectations of your customers. Use services to cache data to increase application performance and reduce the transaction load on your data-storage services. Identify and decommission unused resources. Take advantage of lower-cost data-storage tiers to archive infrequently accessed data.
- Adding a messaging layer between services can have a benefit to performance and scalability. A messaging layer creates a buffer so that requests can continue to flow in without error if the receiving application can't keep up. As the application works through the requests, they'll be answered in the order in which they were received.
- Designing for reliability also focuses on recovery from data loss and from larger-scale disasters. 
- Examples of high-availability design components include clustering and load balancing:
- Recovery point objective (RPO): The maximum duration of acceptable data loss. RPO is measured in units of time, not volume. Examples are "30 minutes of data," "four hours of data," and so on. RPO is about limiting and recovering from data loss, not data theft.
- Recovery time objective (RTO): The maximum duration of acceptable downtime, where "downtime" is defined by your specification. For example, if the acceptable downtime duration is eight hours in the event of a disaster, then your RTO is eight hours.
- Reliability focuses on maintaining service despite temporary conditions and localized failures. Adding redundancy to eliminate single points of failure is a core strategy for improving availability.
- A multilayered approach to securing your environment will increase the security posture of your environment. Commonly known as defense in depth, we can break down the layers as follows:
    - Data
    - Applications
    - VM/compute
    - Networking
    - Perimeter
    - Policies and access
    - Physical security

## Microsoft Azure Well-Architected Framework - Cost optimization
- Two of the most common models are pay-as-you-go and enterprise agreement:
    - Pay-as-you-go subscriptions give you the flexibility to purchase and use the services you need, with the advantage of having no up-front commitments.
    - Enterprise agreements let organizations take advantage of discounts through up-front commitments. These agreements allow organizations to centralize their Azure costs and billing. They can include other Microsoft services, such as Microsoft 365.
- Use Azure Policy to create limitations for the size or tier of resources that can be provisioned.
- Carefully evaluate the workload requirements for your application and select the SKU or tier that matches your resource requirements.
- Spot VMs are great for workloads that can handle interruptions like batch processing jobs, development/test environments, and large compute workloads.
- Whenever possible, take advantage of combining lower resource costs and lower operational costs by using managed services. 
- Microsoft Cost Management gives you insights into where your spend is going, as well as underutilized resources.
- There are three types of cost alerts:
    - Budget alerts notify you when spending, based on usage or cost, reaches or exceeds the amount defined in the alert condition of the budget. 
    - Credit alerts notify you when your Azure credit monetary commitments are consumed. 
    - Department spending quota alerts notify you when department spending reaches a fixed threshold of the quota. 
- A few options are available to achieve cost savings for virtual machines:
    - Choose a smaller size for the virtual machine instance
    - Reduce the number of hours a virtual machine runs
    - Use discounts for the compute costs
- Virtual machine costs are linear within an instance family; each next size larger will double your cost. 
- You should always use the Azure controls to stop your VMs. Shutting down the OS from inside a VM doesn't deallocate its Azure resource, so you'll continue to accrue costs.

## Microsoft Azure Well-Architected Framework - Operational excellence
- Azure Pipelines is a cloud service you can use to automatically build and test your code project and make it available to others.
- A key piece of ensuring that you can develop and deploy applications with confidence is by making sure that your environments are consistent between development, test, and production. 
- When it comes to monitoring and analytics on Azure, we can bundle services into three specific areas of focus:
    - Core monitoring
    - Deep infrastructure monitoring
    - Deep application monitoring
- Activity Log data is only retained for 90 days, although you can archive your data to a storage account, or you can send your data to Azure Log Analytics for longer retention and further analysis.
- Infrastructure as code (IaC) is the management of infrastructure — such as networks, virtual machines, load balancers, and connection topology — in a descriptive model, using a versioning system that's similar to what's used for source code.
- When automating the deployment of services and infrastructure, there are two different approaches you can take: imperative and declarative.
    - With an imperative approach, you explicitly state the commands that are executed to produce the outcome you are looking for.
    - With a declarative approach, you specify what you want the outcome to be instead of specifying how you want it done.    
- On Azure, declarative automation is accomplished through the use of Azure Resource Manager (ARM) templates, which are JSON-structured files that specify what we want created. 
    - ARM templates have four sections: parameters, variables, resources, and outputs.
    - Parameters handle input to be used within the template
    - Variables provide a way to store values for use throughout the template
    - Resources are the things that are being created
    - Outputs provide details to the user of what was created
- There are two common strategies that you can use for the configuration work, which for all intents and purposes are considered to be part of the configuration process for the VM itself: Custom Images & Post deployment scripting.
- Examples of automation of operational tasks might include:
    - Periodically searching for orphaned disks
    - Installing the latest security patches on VMs
    - Searching for and shutting down virtual machines in off hours
    - Running daily reports and producing a dashboard to report to senior management
- A main tenet of a DevOps practice to achieve system reliability is the shift left principle. 
-  Unit Tests should be extensive (they should ideally cover 100% of the code), and quick (typically under 30 seconds, although this number isn't a rule set in stone). 
- Unit tests should be applied both to application code and infrastructure code.
- There are many different ways of confirming that the application is doing what it should
    - Blue/Green deployments: 
    - Canary releases:
    - A/B Testing
- Chaos engineering is a practice adopted by some organizations to identify areas where faults may occur by purposefully making key pieces of infrastructure unavailable.
- Your security tests can also include red team exercises, where security teams attempt to compromise your application.

## Microsoft Azure Well-Architected Framework - Performance efficiency
- DTUs are an abstraction of underlying resources and are a blend of CPU, IO, and memory. For example, you could scale your database in Azure SQL Database from a size of P2 with 250 DTUs up to a P4 with 500 DTUs to give the database more throughput and capacity.
- Changing the service tier or performance level of a database creates a replica of the original database at the new performance level. Connections are then switched over to the replica.
- A common pattern is to externalize your state to another service, like Azure Cache for Redis or SQL Database, which makes your web servers stateless. 
- Containers are lightweight and well suited to scale-out scenarios. 
- A container is a method of running applications in a virtualized environment. A virtual machine is virtualized at the hardware level, where a hypervisor makes it possible to run multiple virtualized operating systems on a single physical server. Containers take the virtualization up a level. The virtualization is done at the OS level, which makes it possible to run multiple identical application instances within the same OS.
- Latency is a measure of delay.
-  Traffic Manager is a DNS-based load balancer that you can use to distribute traffic within and across Azure regions. Rather than having the user browse to a specific instance of your web front end, Traffic Manager can route users based on a set of characteristics:
    - Priority
    - Weighted
    - Performance
    - Geographic
- Premium storage can attach only to specific VM sizes. Premium-storage-capable sizes are designated with an "s" in the name. 
- Any virtual machine type (with or without an "s" in the name) can attach standard storage HDD or SSD drives.
- Azure Cache for Redis is a caching service on Azure that stores data in memory. It's based on the open-source Redis cache and is a fully managed service offering by Microsoft.
- Polyglot persistence is the use of different data storage technologies to handle your storage requirements.
-  Centralized logging is a key part of a good monitoring strategy for any architecture.
- You should use an APM solution such as Application Insights to gain a deep understanding of your application and to correlate activity across your application.
- For custom logs and metrics, you can use the HTTP Data Collector API to write data to Log Analytics from any REST API client or an Azure Logic App to write data from a custom workflow.

## Microsoft Azure Well-Architected Framework - Reliability
- A highly available service is a service that absorbs fluctuations in availability, load, and temporary failures in dependent services and hardware.  This availability is often defined by business requirements, service-level objectives, or service-level agreements.
- There are three steps to evaluate an application for high availability:
    - Determine the service-level agreement of your application
    - Evaluate the HA capabilities of the application
    - Evaluate the HA capabilities of dependent application
- A service-level agreement (SLA) is an agreement between a service provider and a service consumer, in which the service provider commits to a standard of service based on measurable metrics and defined responsibilities. 
- Service-level objectives (SLO) are the values of target metrics that are used to measure performance, reliability, or availability. 
- While update domains represent a logical section of the datacenter, fault domains (FD) represent physical sections of the datacenter and ensure rack diversity of servers in an availability set. 
- Single points of failure will either need to be modified to have HA capabilities integrated, or will need to be replaced with services that can provide HA capabilities.
- There are several core concepts when considering HA for your architecture on Azure:
    - Availability sets
    - Availability zones
    - Load balancing
    - Platform as a service (PaaS) HA capabilities
- Availability sets are a way for you to inform Azure that VMs that belong to the same application workload should be distributed to prevent simultaneous impact from hardware failure and scheduled maintenance. 
- Availability sets are made up of update domains and fault domains.
- To ensure that updates don't happen to a whole datacenter at once, the Azure datacenter is logically sectioned into update domains (UD).
- Fault domains align to the physical separation of shared hardware in the datacenter. This includes power, cooling, and network hardware that supports the physical servers located in server racks.
- Availability zones are independent physical datacenter locations within a region that include their own power, cooling, and networking.
- Availability zones are mutually exclusive with availability sets. When using availability zones, you no longer need to define an availability set for your systems. 
- Azure possesses three load-balancing technology services that are distinct in their abilities to route network traffic:
    - Azure Traffic Manager provides global DNS load balancing. 
    - Azure Application Gateway provides Layer 7 load-balancing capabilities, such as round-robin distribution of incoming traffic, cookie-based session affinity, URL path-based routing, and the ability to host multiple websites behind a single application gateway.
    - Azure Load Balancer is a Layer 4 load balancer. You can configure public and internal load-balanced endpoints and define rules to map inbound connections to back-end pool destinations by using TCP and HTTP health-probing options to manage service availability.
- Regardless of its cause, the best remedy for a disaster once it has occurred is a well-defined, tested disaster recovery plan and an application that actively supports disaster recovery efforts through its design.
- A disaster recovery plan is a single document that details the procedures that are required to recover from data loss and downtime caused by a disaster and identifies who's in charge of directing those procedures.
- Designing for disaster recovery has two main concerns:
    - Data recovery: Using backups and replication to restore lost data
    - Process recovery: Recovering services and deploying code to recover from outages
- Unlike backup, which creates long-lived, read-only snapshots of data for use in recovery, replication creates real-time or near-real-time copies of live data. 
- Choose intervals to perform different types and scopes of tests, such as testing backups and failover mechanisms every month, and performing a full-scale disaster recovery simulation every six months.
- Azure Backup is a family of backup products that back up data to Azure Recovery Services vaults for storage and recovery.
- Four different products and services can use Azure Backup to create backups:
    - Azure Backup Agent
    - System Center Data Protection Manager
    - Azure Backup Server 
    - Azure IaaS VM Backup
- Comprehensive, automatic backup functionality is included with Azure SQL Database at no extra charge. 
- App Service backups are limited to 10 GB total, including app and database content. 
- Most Azure services offer integrated backup functionality, but it is not always enabled by default. You can also add services like Azure Backup Agent as needed to make sure all your data is protected.

## Microsoft Azure Well-Architected Framework - Security
- **Zero Trust model** states that you should never assume trust, but instead continually validate trust.
- Defense in depth is a strategy that employs a series of mechanisms to slow the advance of an attack that's aimed at acquiring unauthorized access to information.
- The common principles that help define a security posture are confidentiality, integrity, and availability, known collectively as CIA.
- SSO reduces user friction by suppressing multiple authentication requests.
- Multifactor authentication provides additional security for your identities by requiring two or more elements for full authentication. These elements fall into three categories:
    - Something you know: A password or the answer to a security question
    - Something you have: A mobile app that receives a notification, or a token-generating device
    - Something you are: Some sort of biometric property such as a fingerprint or face scan used on many mobile devices
- Azure AD Application Proxy can allow users to access the application remotely without any code changes.
- Azure AD Application Proxy has two components. The first is a connector agent that sits on a server running Windows within your corporate network. The second is an external endpoint, either the MyApps portal or an external URL. When a user goes to the endpoint, they authenticate with Azure AD and are routed to the on-premises application via the connector agent.
- Azure AD B2C provides a social identity login experience, while at the same time protecting your customer identity profile information.
- Azure AD B2C directories are distinct from standard Azure AD directories and can be created in the Azure portal.
- **Azure AD Privileged Identity Management (PIM)** is an additional paid-for offering that provides oversight of role assignments, self-service, and just-in-time (JIT) role activation.
- PIM helps mitigate the risk of excessive, unnecessary, or misused access rights.
- Here are some of the key features of PIM:
    - Providing just-in-time privileged access to Azure AD and Azure resources
    - Assigning time-bound access to resources by using start and end dates
    - Requiring approval to activate privileged roles
    - Enforcing Azure AD multifactor authentication to activate any role
    - Using justification to understand why users activate
    - Getting notifications when privileged roles are activated
    - Conducting access reviews to ensure that users still need roles
    - Downloading an audit history for an internal or external audit
- To use PIM, you need one of the following paid or trial licenses:
    - Azure AD Premium P2
    - Enterprise Mobility + Security (EMS) E5
- An *identity* is just a thing that can be authenticated. An account is data associated with an identity.
- A *principal* is an identity that acts with certain roles or claims. 
- There are two top-level types of encryption: symmetric and asymmetric.
- Symmetric encryption uses the same key to encrypt and decrypt the data. 
- Asymmetric encryption uses a public key and private key pair. Either key can encrypt but can't decrypt its own encrypted data. To decrypt, you need the paired key.
- Encryption is typically approached in two ways: encryption at rest and encryption in transit.
- You can classify data into three: Restricted, Private and Public.
- Azure Storage automatically encrypts data in:
    - All Azure Storage services, including Azure Managed Disks, Azure Blob Storage, Azure Files, Azure Queue Storage, and Azure Table Storage
    - Both performance tiers (Standard and Premium)
    - Both deployment models (Azure Resource Manager and classic)
- Azure Disk Encryption is a capability that helps you encrypt your Windows and Linux IaaS virtual machine disks. 
- By default, transparent data encryption is enabled for all newly deployed Azure SQL databases.
- Azure Key Vault is a cloud service that works as a secure store for secrets. These vaults are backed by hardware security modules (HSMs). 
- Network security is protecting the communication of resources within and outside your network.
- The WAF is based on rules from the OWASP 3.0 or 2.2.9 core rule sets. It provides protection from commonly known vulnerabilities such as cross-site scripting and SQL injection.
- Defender for Cloud can report on known vulnerabilities in real time and recommend responses to mitigate them.
- You can even configure Defender for Cloud to automatically execute playbooks in response to attacks.
